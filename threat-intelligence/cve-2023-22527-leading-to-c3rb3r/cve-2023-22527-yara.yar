import "elf" 

rule mal_lnx_ransom_c3rb3r: c3rb3r ransomware {

    meta:
        description = "Detects C3RBER ransomware linux variant seen during exploitation of cve-2023-22527"
        author = "Arctic Wolf Labs"
        date = "2023-02-08"
        category = "malware"   
        reference = "https://arcticwolf.com/resources/blog/confluence-cve-2023-22527-leading-to-c3rb3r-ransomware"
        hash1 = "ac9ee98d9d24744efdf7989ad6d4a937431cef8b"

    strings:
        $s1 ="read-me3.txt"
        $s2 ="C3RB3R_LOG.txt"
        $s3 =".L0CK3D"
        $s4 ="-log"
        $s5 ="-size"
        $s6 ="-nomutex"
        $s7 ="backups"
        $s8 = "local"

    condition:

        uint16(0) == 0x457f
        and 6 of them  
        and filesize < 2MB  
                
}

rule mal_lnx_xorddos: xorddos  {

    meta:
        description = "Detects XorDDoS variant seen during exploitation of cve-2023-22527"
        author = "Arctic Wolf Labs"
        date = "2023-02-08"
        category = "malware"   
        reference = "https://arcticwolf.com/resources/blog/confluence-cve-2023-22527-leading-to-c3rb3r-ransomware"
        hash1 = "1ef4a1f20b17a58a435f6aa6c57980bb2f22bec6"

    strings:
        $m1 = "Hi, man. I've seen several organizations report my Trojan recently, Please let me go. I want to buy a car"
        $m2 = "I don't want to hurt others. I can't help it. My family is very poor. In China, it's hard to buy a suite. I don't have any accommodation."
        $m3 = "45sep79asuwcjz8dltu7xtjbtx7yyf7uo6qt9ymfbqxv8g Jzsdpyd46hoh6dm8paxklnsw9u7vezwu1dqmjkroryan3zeq1"
        $m4 = "They say I'm rude. I'm not rude at all, but I still want to say, fuck your mother"


        $s1 = "cat /proc/cpuinfo|grep cpu\\ MHz|sed -e 's/.*:[^0-9]//'"
        $s2 = "cat /proc/meminfo | grep MemTotal:|sed -e 's/.*:[^0-9]//'"
        $s3 = "ehco %s start >>/etc/rc.local"
        $s4 = "chmod 777 %s;%s %s -l /tmp/%s.txt"
        $s5 = "UDPFlood"
        $s6 = "SYNFlood"
        $s7 = "DealwithDDoS"


        $moz1 = "Mozilla/4.0" 
        $moz2 = "Mozilla/5.0"

    condition:

        uint16(0) == 0x457f
        and elf.symtab_entries > 2000
        and 1 of ($m*)
        and 4 of ($s*)
        and #moz1 > 10
        and #moz2 > 100 
        and filesize < 2MB  
                
}

